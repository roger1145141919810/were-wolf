<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸº ç‹¼äººæ®ºï¼šçµ‚æ¥µé€£ç·šç‰ˆ</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
        /* å…¨åŸŸåŸºç¤æ¨£å¼ */
:root {
    --bg-dark: #121212;
    --card-bg: rgba(255, 255, 255, 0.05);
    --primary-red: #e94560;
    --primary-green: #27ae60;
    --accent-gold: #f1c40f;
    --text-main: #e0e0e0;
}

body {
    font-family: 'Segoe UI', 'PingFang TC', sans-serif;
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
    color: var(--text-main);
    text-align: center;
    margin: 0;
    transition: background 1s ease;
    min-height: 100vh;
}

/* å¤œæ™šæ¨¡å¼åˆ‡æ› */
body.night {
    background: radial-gradient(circle at center, #0f3460 0%, #000000 100%) !important;
}

/* å€å¡Šå®¹å™¨ */
section {
    background: var(--card-bg);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    padding: 20px;
    border-radius: 16px;
    margin: 15px auto;
    max-width: 450px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

/* è¼¸å…¥æ¡†æ¨£å¼ */
input[type="text"] {
    width: 85%;
    padding: 12px;
    margin: 10px 0;
    border-radius: 8px;
    border: 1px solid #444;
    background: rgba(0, 0, 0, 0.3);
    color: white;
    font-size: 16px;
    outline: none;
    transition: border 0.3s;
}

input[type="text"]:focus {
    border-color: var(--primary-red);
}

/* æŒ‰éˆ•ç¾åŒ– */
button {
    padding: 10px 20px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.2s ease;
    text-transform: uppercase;
    letter-spacing: 1px;
}

button:hover {
    transform: translateY(-2px);
    filter: brightness(1.1);
}

.btn-start {
    background: linear-gradient(45deg, var(--primary-green), #2ecc71);
    color: white;
    width: 90%;
    font-size: 18px;
    box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
}

.btn-kick {
    background: var(--primary-red);
    color: white;
    padding: 4px 12px;
    font-size: 11px;
}

/* ç©å®¶åˆ—è¡¨æ¨£å¼ */
.player-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px;
    margin: 8px 0;
    background: rgba(255, 255, 255, 0.03);
    border-radius: 8px;
}

.player-item.dead {
    opacity: 0.4;
    background: rgba(0, 0, 0, 0.2);
    filter: grayscale(1);
}

.player-item span {
    font-weight: 500;
}

/* èŠå¤©å®¤ç¾åŒ– */
#chatBox {
    height: 180px;
    overflow-y: auto;
    background: rgba(0, 0, 0, 0.4);
    border-radius: 8px;
    padding: 12px;
    font-size: 14px;
    margin-bottom: 15px;
    border: 1px solid rgba(255, 255, 255, 0.05);
}

#chatBox div {
    margin-bottom: 6px;
    line-height: 1.4;
}

#chatBox b {
    color: var(--accent-gold);
}

/* æ²è»¸ç¾åŒ– */
#chatBox::-webkit-scrollbar {
    width: 6px;
}
#chatBox::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.2);
    border-radius: 10px;
}
    </style>
</head>
<body>
    <div id="setup">
        <h2>ğŸº ç‹¼äººæ®ºï¼šåŠ å…¥æ‘èŠ</h2>
        <input type="text" id="roomInput" placeholder="è¼¸å…¥æˆ¿é–“è™Ÿç¢¼ (ä¾‹å¦‚: 888)">
        <input type="text" id="username" placeholder="ä½ çš„æš±ç¨±">
        <button onclick="join()" style="background:#27ae60; color:white; width:85%; margin-top:10px;">é€²å…¥æˆ¿é–“</button>
    </div>

    <main id="game" class="hidden">
        <section>
            <div id="roomTitle">æˆ¿é–“ï¼š<span id="displayRoom" style="color:#f1c40f;"></span></div>
            <div id="myRole" style="font-size:24px; color:#f1c40f; margin:10px 0;">â³ ç­‰å¾…ç™¼ç‰Œ...</div>
            <button id="startBtn" class="hidden" onclick="start()" style="background:#27ae60; color:white; width:100%;">é–‹å§‹éŠæˆ² (è‡³å°‘6äºº)</button>
        </section>

        <section>
            <h3>ç©å®¶åˆ—è¡¨ (<span id="pCount">0</span>)</h3>
            <div id="playerList"></div>
        </section>

        <section>
            <div id="chatBox"></div>
            <input type="text" id="chatInput" placeholder="è¼¸å…¥è¨Šæ¯..."><button onclick="send()" style="background:#e94560; color:white;">é€å‡º</button>
        </section>
    </main>

    <script>
        const socket = io("https://were-wolf.onrender.com");
        let myName = "", amIHost = false, myRole = "";

        function join() {
            const r = document.getElementById("roomInput").value;
            myName = document.getElementById("username").value;
            if(r && myName) {
                socket.emit('joinRoom', { roomId: r, username: myName });
                document.getElementById("displayRoom").innerText = r;
            }
        }

        socket.on('updatePlayers', ({ players, status }) => {
            document.getElementById("setup").classList.add("hidden");
            document.getElementById("game").classList.remove("hidden");
            document.getElementById("pCount").innerText = players.length;

            const list = document.getElementById("playerList");
            list.innerHTML = "";
            players.forEach(p => {
                const div = document.createElement("div");
                div.className = `player-item ${!p.isAlive ? 'dead' : ''}`;
                div.innerHTML = `<span>${p.isHost ? 'ğŸ‘‘' : ''} ${p.name} ${!p.isAlive ? '(æ·˜æ±°)' : ''}</span>`;
                
                // æˆ¿é•·åœ¨ç­‰å¾…å»³å¯ä»¥è¸¢äºº
                if(amIHost && status === 'waiting' && p.id !== socket.id) {
                    const btn = document.createElement("button");
                    btn.innerText = "è¸¢å‡º"; btn.className = "btn-kick";
                    btn.onclick = () => socket.emit('kickPlayer', p.id);
                    div.appendChild(btn);
                }
                // é è¨€å®¶åŠŸèƒ½
                if(myRole === 'é è¨€å®¶' && status === 'playing' && p.id !== socket.id && p.isAlive) {
                    const btn = document.createElement("button");
                    btn.innerText = "æŸ¥é©—"; btn.className = "btn-action";
                    btn.onclick = () => socket.emit('checkRole', p.id);
                    div.appendChild(btn);
                }
                list.appendChild(div);
            });

            if(amIHost && status === 'waiting') {
                const b = document.getElementById("startBtn");
                b.classList.remove("hidden");
                b.disabled = players.length < 6;
                b.style.opacity = players.length < 6 ? "0.5" : "1";
            }
        });

        socket.on('assignRole', (role) => {
            myRole = role;
            document.getElementById("myRole").innerText = "èº«åˆ†ï¼š" + role;
            document.body.classList.add("night");
        });

        socket.on('checkResult', r => alert(r));
        socket.on('gameOver', d => {
            alert(`ğŸ‰ ${d.winner} å‹åˆ©ï¼\n\nå…¬å¸ƒèº«åˆ†ï¼š\n` + d.allRoles.map(p => `${p.name}: ${p.role}`).join('\n'));
            location.reload();
        });

        socket.on('hostStatus', s => amIHost = s);
        socket.on('errorMessage', m => alert(m));
        function start() { socket.emit('startGame'); }
        function send() { 
            const i = document.getElementById("chatInput");
            if(i.value) { socket.emit('sendMessage', { name: myName, text: i.value }); i.value = ""; }
        }
        socket.on('receiveMessage', d => {
            const b = document.getElementById("chatBox");
            b.innerHTML += `<div><b>${d.name}:</b> ${d.text}</div>`;
            b.scrollTop = b.scrollHeight;
        });
    </script>
</body>
</html>
