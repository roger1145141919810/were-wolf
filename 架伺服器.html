<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸº ç‹¼äººæ®ºï¼šæˆ¿é•·ç‰¹æ¬Šç‰ˆ</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
        body { font-family: sans-serif; background: #2c3e50; color: white; text-align: center; margin: 0; padding: 10px; transition: 1.5s; }
        body.night { background: #1a1a2e !important; color: #e94560 !important; }
        body.day { background: #f39c12 !important; color: #2c3e50 !important; }
        section { background: rgba(0,0,0,0.2); padding: 15px; border-radius: 10px; margin: 10px auto; max-width: 500px; }
        #chatBox { height: 180px; overflow-y: auto; background: rgba(255,255,255,0.1); border-radius: 5px; padding: 10px; text-align: left; }
        .msg { margin-bottom: 5px; }
        .host-msg { color: #f1c40f; font-weight: bold; border-left: 3px solid #f1c40f; padding-left: 5px; }
        .quick-box { display: none; background: rgba(241, 196, 15, 0.2); border: 1px dashed #f1c40f; padding: 10px; margin-top: 10px; }
        button { padding: 8px 12px; border-radius: 5px; border: none; background: #e94560; color: white; cursor: pointer; margin: 3px; }
        .btn-quick { background: #f1c40f; color: #2c3e50; font-size: 12px; }
        input { padding: 10px; width: 60%; border-radius: 5px; border: none; }
    </style>
</head>
<body>

    <section id="setup">
        <h2>ğŸº ç‹¼äººæ®ºè¯ç·š</h2>
        <input type="text" id="username" placeholder="è¼¸å…¥æš±ç¨±">
        <button id="joinBtn">åŠ å…¥éŠæˆ²</button>
    </section>

    <main id="game" hidden>
        <div id="hostBadge" style="color: #f1c40f; display: none;">ğŸ‘‘ ä½ æ˜¯æˆ¿é•·</div>
        <div id="myRole" style="font-size: 24px; font-weight: bold; margin: 10px;">ç­‰å¾…ç™¼ç‰Œ...</div>
        
        <button id="startBtn" style="display: none; background: #27ae60;">é–‹å§‹éŠæˆ² (æˆ¿é•·å°ˆç”¨)</button>
        <button id="claimHostBtn" class="btn-quick">æ¶ç•¶æˆ¿é•·</button>

        <div id="quickChat" class="quick-box">
            <p style="margin: 0 0 5px 0; font-size: 14px;">ğŸ‘‘ æˆ¿é•·å¿«æ·å…¬å‘Š</p>
            <button class="btn-quick" onclick="sendQuick('å¤©é»‘è«‹é–‰çœ¼ï¼Œç‹¼äººè«‹çœçœ¼')">ğŸŒ™ å¤©é»‘é–‰çœ¼</button>
            <button class="btn-quick" onclick="sendQuick('å¤©äº®äº†ï¼Œæ˜¨æ™šæ­»çš„æ˜¯...')">â˜€ï¸ å¤©äº®å…¬å‘Š</button>
            <button class="btn-quick" onclick="sendQuick('è«‹å¤§å®¶é–‹å§‹è¼ªæµç™¼è¨€')">ğŸ“¢ é–‹å§‹ç™¼è¨€</button>
            <button class="btn-quick" onclick="sendQuick('è«‹åœ¨ 30 ç§’å…§å®ŒæˆæŠ•ç¥¨')">ğŸ—³ï¸ é–‹å§‹æŠ•ç¥¨</button>
        </div>

        <section>
            <div id="chatBox"></div>
            <input type="text" id="chatInput" placeholder="è¼¸å…¥è¨Šæ¯...">
            <button id="sendBtn">ç™¼é€</button>
        </section>

        <p>ç·šä¸Šäººæ•¸ï¼š<span id="aliveCount">0</span></p>
    </main>

    <script>
        const RENDER_URL = "https://were-wolf.onrender.com"; 
        const socket = io(RENDER_URL);
        let myName = "";
        let amIHost = false;

        const joinBtn = document.getElementById("joinBtn");
        const startBtn = document.getElementById("startBtn");
        const quickChat = document.getElementById("quickChat");
        const hostBadge = document.getElementById("hostBadge");

        joinBtn.onclick = () => {
            myName = document.getElementById("username").value;
            if (!myName) return;
            socket.emit('joinGame', myName);
            document.getElementById("setup").hidden = true;
            document.getElementById("game").hidden = false;
        };

        // æ¶ç•¶æˆ¿é•·
        document.getElementById("claimHostBtn").onclick = () => {
            socket.emit('claimHost');
        };

        // æˆ¿é•·å¿«æ·ç™¼è¨€
        function sendQuick(txt) {
            socket.emit('sendMessage', { name: "ğŸ‘‘ æˆ¿é•·å…¬å‘Š", text: txt, isHost: true });
        }

        // æ¥æ”¶è¨Šæ¯
        socket.on('receiveMessage', (data) => {
            const div = document.createElement("div");
            div.className = data.isHost ? "msg host-msg" : "msg";
            div.innerHTML = `<span>${data.name}:</span> ${data.text}`;
            document.getElementById("chatBox").appendChild(div);
            document.getElementById("chatBox").scrollTop = document.getElementById("chatBox").scrollHeight;
        });

        // æ›´æ–°æˆ¿é•·æ¬Šé™
        socket.on('hostStatus', (isHost) => {
            updateHostUI(isHost);
        });

        socket.on('hostChanged', (hostId) => {
            updateHostUI(socket.id === hostId);
        });

        function updateHostUI(isHost) {
            amIHost = isHost;
            startBtn.style.display = isHost ? "inline-block" : "none";
            quickChat.style.display = isHost ? "block" : "none";
            hostBadge.style.display = isHost ? "block" : "none";
        }

        // åŸºç¤é‚è¼¯
        startBtn.onclick = () => socket.emit('startGame');
        document.getElementById("sendBtn").onclick = () => {
            const txt = document.getElementById("chatInput").value;
            if(txt) {
                socket.emit('sendMessage', { name: myName, text: txt });
                document.getElementById("chatInput").value = "";
            }
        };

        socket.on('updatePlayers', (players) => {
            document.getElementById("aliveCount").textContent = players.length;
        });

        socket.on('assignRole', (role) => {
            document.getElementById("myRole").innerText = "èº«åˆ†ï¼š" + role;
            document.body.className = "night";
        });
    </script>
</body>
</html>
