<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸº è¯ç·šç‰ˆç‹¼äººæ®º</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
        body { font-family: "Microsoft JhengHei", sans-serif; background: #1a1a2e; color: white; text-align: center; margin: 0; padding: 20px; }
        header { background: #16213e; padding: 10px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.5); }
        section { background: #0f3460; padding: 20px; border-radius: 10px; margin: 10px auto; max-width: 500px; }
        input, button { padding: 12px 20px; margin: 10px; border-radius: 5px; border: none; font-size: 16px; }
        input { width: 60%; }
        button { background: #e94560; color: white; cursor: pointer; font-weight: bold; }
        button:disabled { background: #555; }
        ul { list-style: none; padding: 0; }
        li { background: #16213e; padding: 10px; margin: 5px 0; border-radius: 5px; display: flex; justify-content: space-between; }
        .role-box { font-size: 24px; color: #f1c40f; font-weight: bold; margin: 15px 0; }
        #logContent { height: 150px; overflow-y: auto; background: #1a1a2e; padding: 10px; border-radius: 5px; text-align: left; font-size: 14px; }
    </style>
</head>
<body>

    <header>
        <h1>ğŸº ç‹¼äººæ®ºè¯ç·šç‰ˆ</h1>
    </header>

    <section id="setup">
        <h2>æ­¡è¿åŠ å…¥æˆ¿é–“</h2>
        <input type="text" id="username" placeholder="è«‹è¼¸å…¥ä½ çš„æš±ç¨±">
        <button id="joinBtn">åŠ å…¥éŠæˆ²</button>
    </section>

    <main id="game" hidden>
        <section id="status">
            <div id="myRole" class="role-box">ç­‰å¾…æ³•å®˜ç™¼ç‰Œ...</div>
            <p>ç›®å‰ç‹€æ…‹ï¼š<span id="round">ç™½å¤©</span></p>
            <button id="startBtn">æˆ¿é•·é–‹å§‹éŠæˆ²</button>
        </section>

        <section id="players">
            <h3>ç©å®¶åˆ—è¡¨ (<span id="aliveCount">0</span>)</h3>
            <ul id="playerList"></ul>
        </section>

        <section id="actions">
            <button id="killBtn" disabled>ç‹¼äººè¡Œå‹•</button>
            <button id="voteBtn" disabled>ç™½å¤©æŠ•ç¥¨</button>
        </section>

        <section id="log">
            <h3>éŠæˆ²ç´€éŒ„</h3>
            <div id="logContent"></div>
        </section>
    </main>

    <script>
        // ã€é‡è¦ã€‘è«‹æŠŠä¸‹æ–¹çš„ç¶²å€æ›æˆä½ åœ¨ Render å¾—åˆ°çš„ç¶²å€
        const RENDER_URL = "https://your-server-name.onrender.com"; 
        const socket = io(RENDER_URL);

        const joinBtn = document.getElementById("joinBtn");
        const startBtn = document.getElementById("startBtn");
        const setup = document.getElementById("setup");
        const game = document.getElementById("game");
        const playerList = document.getElementById("playerList");
        const myRoleDisplay = document.getElementById("myRole");
        const logContent = document.getElementById("logContent");

        // é»æ“ŠåŠ å…¥æˆ¿é–“
        joinBtn.onclick = () => {
            const name = document.getElementById("username").value;
            if (!name) return alert("è«‹è¼¸å…¥åå­—ï¼");
            socket.emit('joinGame', name);
            setup.hidden = true;
            game.hidden = false;
            log("æ­£åœ¨é€£ç·šè‡³æ³•å®˜...");
        };

        // é»æ“Šé–‹å§‹éŠæˆ²
        startBtn.onclick = () => {
            socket.emit('startGame');
        };

        // æ¥æ”¶ç©å®¶æ¸…å–®æ›´æ–°
        socket.on('updatePlayers', (players) => {
            playerList.innerHTML = "";
            players.forEach(p => {
                const li = document.createElement("li");
                li.innerHTML = `<span>ğŸ‘¤ ${p.name}</span> <span>${p.role ? 'å·²å°±ç·’' : 'ç­‰å¾…ä¸­'}</span>`;
                playerList.appendChild(li);
            });
            document.getElementById("aliveCount").textContent = players.length;
        });

        // æ¥æ”¶èº«åˆ†ç™¼æ”¾
        socket.on('assignRole', (role) => {
            myRoleDisplay.innerText = "ä½ çš„èº«åˆ†æ˜¯ï¼š" + role;
            log("æ³•å®˜å·²ç™¼ç‰Œï¼ŒéŠæˆ²é–‹å§‹ï¼");
            startBtn.style.display = "none"; // éŠæˆ²é–‹å§‹å¾Œéš±è—é–‹å§‹æŒ‰éˆ•
        });

        // ç´€éŒ„è¨Šæ¯å·¥å…·
        function log(msg) {
            const p = document.createElement("p");
            p.textContent = `> ${msg}`;
            logContent.appendChild(p);
            logContent.scrollTop = logContent.scrollHeight;
        }

        // è™•ç†é€£ç·šå¤±æ•—
        socket.on('connect_error', () => {
            log("éŒ¯èª¤ï¼šç„¡æ³•é€£ç·šåˆ° Render ä¼ºæœå™¨ï¼Œè«‹ç¢ºèªç¶²å€æ­£ç¢ºä¸”ä¼ºæœå™¨å·²å•Ÿå‹•ã€‚");
        });
    </script>
</body>
</html>
