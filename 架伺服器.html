<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸº ç‹¼äººæ®ºè¯ç·šç‰ˆ - èªéŸ³èŠå¤©ç‰ˆ</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
        body { font-family: sans-serif; background: #2c3e50; color: white; text-align: center; margin: 0; padding: 10px; transition: 1.5s; }
        body.night { background: #1a1a2e !important; color: #e94560 !important; }
        body.day { background: #f39c12 !important; color: #2c3e50 !important; }

        section { background: rgba(0,0,0,0.2); padding: 15px; border-radius: 10px; margin: 10px auto; max-width: 500px; }
        
        /* èŠå¤©å®¤å¤–è§€ */
        #chatBox { height: 200px; overflow-y: auto; background: rgba(255,255,255,0.1); border-radius: 5px; padding: 10px; text-align: left; margin-bottom: 10px; }
        .msg { margin-bottom: 5px; line-height: 1.4; }
        .msg-name { font-weight: bold; color: #f1c40f; }

        input { padding: 10px; border-radius: 5px; border: none; width: 70%; }
        button { padding: 10px 15px; border-radius: 5px; border: none; background: #e94560; color: white; font-weight: bold; cursor: pointer; }
        #logContent { height: 100px; overflow-y: auto; font-size: 12px; opacity: 0.7; text-align: left; }
    </style>
</head>
<body>

    <section id="setup">
        <h2>ğŸº ç‹¼äººæ®ºæ‘èŠ</h2>
        <input type="text" id="username" placeholder="ä½ çš„åå­—">
        <button id="joinBtn">åŠ å…¥</button>
    </section>

    <main id="game" hidden>
        <div id="myRole" style="font-size: 24px; font-weight: bold;">ç­‰å¾…ç™¼ç‰Œ...</div>
        <p>ç‹€æ…‹ï¼š<span id="roundDisplay">æº–å‚™ä¸­</span> | äººæ•¸ï¼š<span id="aliveCount">0</span></p>
        <button id="startBtn">é–‹å§‹éŠæˆ²</button>

        <section id="chatSection">
            <h3>æ‘èŠèŠå¤©å®¤</h3>
            <div id="chatBox"></div>
            <input type="text" id="chatInput" placeholder="æƒ³èªªä»€éº¼ï¼Ÿ">
            <button id="sendBtn">ç™¼é€</button>
        </section>

        <section id="log">
            <div id="logContent"></div>
        </section>
    </main>

    <script>
        const RENDER_URL = "https://were-wolf.onrender.com"; 
        const socket = io(RENDER_URL);
        let myName = "";

        const joinBtn = document.getElementById("joinBtn");
        const chatInput = document.getElementById("chatInput");
        const sendBtn = document.getElementById("sendBtn");
        const chatBox = document.getElementById("chatBox");

        // 1. åŠ å…¥éŠæˆ²
        joinBtn.onclick = () => {
            myName = document.getElementById("username").value;
            if (!myName) return alert("è«‹è¼¸å…¥åå­—");
            socket.emit('joinGame', myName);
            document.getElementById("setup").hidden = true;
            document.getElementById("game").hidden = false;
        };

        // 2. ç™¼é€è¨Šæ¯
        function handleSend() {
            const text = chatInput.value;
            if (!text) return;
            socket.emit('sendMessage', { name: myName, text: text });
            chatInput.value = "";
        }
        sendBtn.onclick = handleSend;
        chatInput.onkeypress = (e) => { if(e.key === 'Enter') handleSend(); };

        // 3. æ¥æ”¶è¨Šæ¯ä¸¦é¡¯ç¤º
        socket.on('receiveMessage', (data) => {
            const div = document.createElement("div");
            div.className = "msg";
            div.innerHTML = `<span class="msg-name">${data.name}:</span> ${data.text}`;
            chatBox.appendChild(div);
            chatBox.scrollTop = chatBox.scrollHeight; // è‡ªå‹•æ²åˆ°åº•éƒ¨
        });

        // 4. å…¶ä»–åŸæœ¬çš„é€£ç·šé‚è¼¯
        socket.on('updatePlayers', (players) => {
            document.getElementById("aliveCount").textContent = players.length;
        });

        socket.on('assignRole', (role) => {
            document.getElementById("myRole").innerText = "èº«åˆ†ï¼š" + role;
            document.body.className = "night";
            document.getElementById("roundDisplay").innerText = "å¤œæ™š";
            document.getElementById("startBtn").style.display = "none";
        });

        function log(msg) {
            const p = document.createElement("p");
            p.textContent = `> ${msg}`;
            document.getElementById("logContent").appendChild(p);
        }
    </script>
</body>
</html>
